{"remainingRequest":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/src/Index.vue?vue&type=style&index=0&id=fb3be2a2&prod&lang=scss&scoped=true","dependencies":[{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/src/Index.vue","mtime":1703736931000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/admin/projects/cybercrowdcoin/cybercrowdcoin-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4vSW5kZXguc2NzcyI7CiogewogIGZvbnQtd2VpZ2h0OiA0MDA7Cn0K"},{"version":3,"sources":["Index.vue"],"names":[],"mappings":";AA6UA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div class=\"ccc-index\">\n    <div class=\"head_logo\">\n      <div class=\"head_logo_l\">\n        <img src=\"./assets/logo.png\" alt=\"\" />\n        <p>CCC</p>\n      </div>\n      <div class=\"head_logo_r\">\n        <div\n          style=\"cursor: pointer; margin-right: 25px\"\n          @click=\"loginWithMetaMask\"\n        >\n          <i class=\"iconfont icon-wangluo\"></i>\n          <span>Connect Wallet</span>\n        </div>\n        <div>\n          <i class=\"icon-geren iconfont\"></i>\n          <span>{{ userName }}</span>\n        </div>\n      </div>\n    </div>\n    <el-container>\n      <el-aside width=\"230px\" style=\"position: relative\">\n        <div class=\"ccc-menu\">\n          <el-menu :default-active=\"onRoutes\">\n            <div v-for=\"(item, index) in submenuList\" :key=\"index\">\n              <!-- 一级菜单（没有任何子级菜单）-->\n              <el-menu-item\n                @click=\"goCon(item.path)\"\n                :index=\"item.path\"\n                v-if=\"!item.menuList\"\n              >\n                <i :class=\"item.icon + ' iconfont'\"></i>\n                {{ item.title }}\n              </el-menu-item>\n\n              <!-- 一级菜单（有子级菜单）-->\n              <el-submenu :index=\"item.path\" v-else>\n                <template slot=\"title\"\n                  ><i :class=\"item.icon + ' iconfont'\"></i\n                  >{{ item.title }}</template\n                >\n\n                <!-- 遍历二级菜单容器 -->\n                <div v-for=\"(i, index) in item.menuList\" :key=\"index\">\n                  <!-- 判断二级菜单（没有三级菜单）-->\n                  <el-menu-item\n                    @click=\"goCon(i.path)\"\n                    :index=\"i.path\"\n                    v-if=\"!i.list\"\n                    style=\"font-size: 13px\"\n                  >\n                    <i style=\"margin-right: 7px; font-weight: bold\"></i>\n                    {{ i.title }}</el-menu-item\n                  >\n\n                  <!-- 判断二级菜单（有三级菜单）-->\n                  <el-submenu\n                    :index=\"i.path\"\n                    v-else\n                    style=\"padding-left: 15px !important\"\n                    class=\"two_have_three_menu\"\n                  >\n                    <template slot=\"title\"\n                      ><span style=\"font-size: 13px\">{{\n                        i.title\n                      }}</span></template\n                    >\n                    <el-menu-item\n                      :index=\"j.path\"\n                      v-for=\"(j, index) in i.list\"\n                      :key=\"index\"\n                      @click=\"goCon(j.path)\"\n                      style=\"padding-left: 27px\"\n                    >\n                      {{ j.title }}\n                    </el-menu-item>\n                  </el-submenu>\n                </div>\n              </el-submenu>\n            </div>\n          </el-menu>\n        </div>\n\n        <div class=\"aside_footer\">\n          <el-dropdown>\n            <span class=\"el-dropdown-link\">\n              <i class=\"iconfont iconfont icon-shezhi-xianxing\"></i>\n            </span>\n            <el-dropdown-menu slot=\"dropdown\">\n              <div @click=\"handleLogout\">\n                <el-dropdown-item icon=\"iconfont icon-tuichudenglu\"\n                  >Log out</el-dropdown-item\n                >\n              </div>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </div>\n      </el-aside>\n\n      <el-container class=\"el-container123\" style=\"padding: 0 20px\" width=\"70%\">\n        <router-view name=\"main\" />\n      </el-container>\n    </el-container>\n  </div>\n</template>\n\n<script>\nimport Web3 from \"web3\";\nimport { ethers } from \"ethers\";\nimport axios from \"axios\";\nimport { baseURL } from \"./api/apiUrl\";\nimport { mapMutations } from \"vuex\";\nimport { web3, provider, estimateGas } from \"./util/web3\";\n\nexport default {\n  inject: [\"reload\"],\n  data() {\n    return {\n      isCollapse: false,\n      account: null,\n      userName: \"\",\n\n      submenuList: [\n        {\n          title: \"Home\",\n          path: \"/\",\n          icon: \"icon-shouye\",\n        },\n        {\n          title: \"Swap\",\n          path: \"/Swap\",\n          icon: \"icon-shouye\",\n        },\n        {\n          title: \"Demand Market\",\n          path: \"/DemandMarket/DemandList\",\n          icon: \"icon-gongzuo\",\n          menuList: [\n            { title: \"ALL Demand List\", path: \"/DemandMarket/DemandList\" },\n            {\n              title: \"ALL Candidate List\",\n              path: \"/DemandMarket/CandidateList\",\n            },\n          ],\n        },\n        {\n          title: \"Personal Center\",\n          path: \"/PersonalCenter\",\n          icon: \"icon-geren\",\n          menuList: [\n            {\n              title: \"Employer Demand\",\n              path: \"/PersonalCenter/DemandNew\",\n              list: [\n                { title: \"Demand New\", path: \"/PersonalCenter/DemandNew\" },\n                { title: \"Demand List\", path: \"/PersonalCenter/DemandList\" },\n              ],\n            },\n            {\n              title: \"Candidate Protocol\",\n              path: \"/PersonalCenter/ProtocolList\",\n              list: [\n                {\n                  title: \"Protocol List\",\n                  path: \"/PersonalCenter/ProtocolList\",\n                },\n              ],\n            },\n            {\n              title: \"Candidate Profile\",\n              path: \"/PersonalCenter/CandidateProfile\",\n              list: [\n                {\n                  title: \"Register\",\n                  path: \"/PersonalCenter/CandidateProfile\",\n                },\n              ],\n            },\n          ],\n        },\n      ],\n    };\n  },\n\n  created() {\n    this.userName = localStorage.getItem(\"userName\");\n    let expire = localStorage.getItem(\"expire\");\n    let now = Date.now();\n    if (now <= expire) {\n      this.SET_USERNAME(this.userName);\n      this.userName =\n        this.userName.slice(0, 5) + \"...\" + this.userName.slice(-4);\n    } else {\n      this.userName = \"\";\n    }\n  },\n\n  methods: {\n    ...mapMutations([\"SET_USERNAME\"]),\n    goCon(conE) {\n      if (this.$route.path === conE) {\n        return;\n      } else {\n        this.$router.push(conE);\n      }\n    },\n\n    async loginWithMetaMask() {\n      if (typeof window.ethereum !== \"undefined\") {\n        try {\n          // 请求用户账户地址\n          const accounts = await window.ethereum.request({\n            method: \"eth_requestAccounts\",\n          });\n          const account = accounts[0];\n          // 获取与当前帐户关联的签名者\n          const signer = provider.getSigner();\n          // 获取签名者的地址（这应该与上面获取的账户地址相同）\n          const signerAddress = await signer.getAddress();\n          console.log(\"Signer address:\", signerAddress);\n\n          console.log(\"Connected account:\", account);\n          let nonce, sign;\n          axios\n            .get(baseURL + \"/ccc/user/nonce?address=\" + signerAddress)\n            .then((res) => {\n              nonce = res.data.data.nonce;\n            })\n            .then(() => {\n              console.log(nonce);\n              const msgParams = {\n                domain: {\n                  chainId: window.ethereum.chainId,\n                  name: \"Login\",\n                  version: \"1\",\n                },\n                message: {\n                  contents: \"Login\",\n                  nonce: nonce,\n                },\n                primaryType: \"Login\",\n                types: {\n                  EIP712Domain: [\n                    { name: \"name\", type: \"string\" },\n                    { name: \"version\", type: \"string\" },\n                    { name: \"chainId\", type: \"uint256\" },\n                  ],\n                  Login: [\n                    { name: \"contents\", type: \"string\" },\n                    { name: \"nonce\", type: \"uint256\" },\n                  ],\n                },\n              };\n              window.ethereum\n                .request({\n                  method: \"eth_signTypedData_v4\",\n                  params: [signerAddress, JSON.stringify(msgParams)],\n                })\n                .then((res) => {\n                  sign = res;\n                  console.log(res);\n                })\n                .then(() => {\n                  axios\n                    .post(baseURL + \"/ccc/user/sign-check\", {\n                      chainId: window.ethereum.chainId,\n                      address: signerAddress,\n                      signature: sign,\n                    })\n                    .then((res) => {\n                      if (res.data.success) {\n                        localStorage.setItem(\"token\", res.data.data.token);\n                        localStorage.setItem(\"expire\", Date.now() + 3600000);\n                        localStorage.setItem(\"userName\", signerAddress);\n                        this.$message.success(\"Login success\");\n                        window.location.reload();\n                        return { success: true, account: signerAddress };\n                      } else {\n                        this.$message.error(\"Login failed\");\n                        return { success: false };\n                      }\n                    });\n                });\n            });\n        } catch (error) {\n          console.error(\"User rejected request:\", error);\n        }\n      } else {\n        alert(\"请安装MetaMask！\");\n      }\n    },\n\n    handleLogout() {\n      this.$confirm(\"Are you sure you want to log out?\", \"Tips\", {\n        confirmButtonText: \"Confirm\",\n        cancelButtonText: \"Cancel\",\n        type: \"warning\",\n      })\n        .then(() => {\n          localStorage.removeItem(\"token\");\n          localStorage.removeItem(\"userName\");\n          this.$message({\n            type: \"success\",\n            message: \"You have successfully logged out!\",\n          });\n          this.refresh();\n        })\n        .catch(() => {\n          this.$message({\n            type: \"info\",\n            message: \"Cancelled operation\",\n          });\n        });\n    },\n\n    // 刷新\n    refresh() {\n      this.reload();\n    },\n  },\n\n  computed: {\n    // 动态返回对应的路由path\n    onRoutes() {\n      if (this.$route.path.includes(\"/Swap\")) return \"/Swap\";\n      return this.$route.path;\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"./Index.scss\";\n* {\n  font-weight: 400;\n}\n</style>\n"]}]}